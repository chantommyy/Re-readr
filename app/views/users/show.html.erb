
<%# tells us the name of the data controller eg tabulator %>
<div class="contents" data-controller="tabulator">
  <div class="tab">
    <button data-tabulator-target="booksLink" data-action="click->tabulator#displayBooks">Bookshelf</button>
    <button data-tabulator-target="profileLink" data-action="click->tabulator#displayProfile">Profile</button>
    <button data-tabulator-target="reviewsLink" data-action="click->tabulator#displayReviews">Add Review</button>
  </div>
  <%# calculate the average rating %>
  <% if @reviews.length > 0 %>
    <% @total = 0 %>
    <% @reviews.each do |review| %>
      <% @total += review.rating  %>
    <% end %>
    <% @average =  (@total.to_f / @reviews.length) %>
    <%@averageround =  (@total.to_f / @reviews.length).round(1) %>
  <% end  %>


<%# Books tab %>
  <div data-tabulator-target="books" class="tabcontent">
      <h3>Available Books</h3>
      <p>Have a look at my wares to be traded!</p>
      <ul>
        <% @user.books.each do |book| %>
         <li><%= book.name %></li>
          <%= button_to request_user_swaps_path(@request, @user), data: {turbo_method: :post} do %>
          <%= hidden_field_tag "book_id", book.id %>
          <% end %>
      <% end %>
      </ul>
      <%= link_to "home", root_path %>
  </div>

<%# Profile tab %>
  <div data-tabulator-target="profile" class="tabcontent">
    <div class="profile-container container-row">
      <div class="profile-card layer1">
          <div class="center">
            <div class="profile">
              <div class="image">
                <div class="circle-1"></div>
                <div class="circle-2"></div>
                <img src="https://www.gravatar.com/avatar/9017a5f22556ae0eb7fb0710711ec125?s=128" width="70" height="70" alt="<%= @user.first_name %> <%= @user.last_name %>">
              </div>
              <div class="name"><%= @user.first_name %> <%= @user.last_name %></div>
              <div class="address">My adress is this house name</div>
              <div class="actions">
              </div>
            </div>

            <div class="stats">
              <div class="box">
                <span class="value"><%= @averageround %></span>
                <span class="parameter">Average Rating</span>
                <div class="Stars" style="--rating: <%= @average %>;" aria-label="Rating of this product is  <%= @averageround %> out of 5."></div>
              </div>
              <div class="box">
                <span class="value">5</span>
                <%# add swaps.length below when model made %>
                <span class="parameter">Previous Swaps</span>
              </div>
              <div class="box">
                <span class="value">Crime</span>
                <span class="parameter">Favourite Genre</span>
              </div>
            </div>
          </div>
      </div>
    <div class="review-container layer2">
      <% @reviews.each do |review| %>
        <div class="review-card">
          <img src="https://www.gravatar.com/avatar/9017a5f22556ae0eb7fb0710711ec125?s=128" alt="Avatar" style="width:90px">
          <span style="text-alight: right"><%= review.user.first_name %></span>
          <h3><%= review.comment %></h3>
          <p><%= review.rating %></p>
          <div class="Stars" style="--rating: <%= review.rating %>;" aria-label="Rating of this product is  <%= review.rating %> out of 5."></div>
        </div>
      <% end %>
    </div>
    </div>
  </div>




<%# Reviews tab %>

  <div data-tabulator-target="reviews">
    <div class="make-review-container">
    <h2> Add a review </h2>
    <%=  simple_form_for ([@request, @user, @review]) do |f| %>
      <%= f.input :rating, :collection => %w[0 1 2 3 4 5]  %>
      <%= f.input :comment %>
      <%= f.submit "Submit review", data: { turbo_method: :post } %>
    <% end %>
    </div>
  </div>
</div>
